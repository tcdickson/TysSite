<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>designdocument</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projectPage.html" rel="" target="">
 <span class="menu-text">Additional Projects</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#design-document" id="toc-design-document" class="nav-link active" data-scroll-target="#design-document">Design Document</a>
  <ul class="collapse">
  <li><a href="#design-considerations" id="toc-design-considerations" class="nav-link" data-scroll-target="#design-considerations">1 Design Considerations</a>
  <ul class="collapse">
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">1.1 Assumptions</a></li>
  <li><a href="#constraints" id="toc-constraints" class="nav-link" data-scroll-target="#constraints">1.2 Constraints</a></li>
  <li><a href="#system-environment" id="toc-system-environment" class="nav-link" data-scroll-target="#system-environment">1.3 System Environment</a></li>
  </ul></li>
  <li><a href="#architectural-design" id="toc-architectural-design" class="nav-link" data-scroll-target="#architectural-design">2 Architectural Design</a>
  <ul class="collapse">
  <li><a href="#component-diagram" id="toc-component-diagram" class="nav-link" data-scroll-target="#component-diagram">2.1 Component Diagram</a></li>
  <li><a href="#deployment-diagram" id="toc-deployment-diagram" class="nav-link" data-scroll-target="#deployment-diagram">2.2 Deployment Diagram</a></li>
  </ul></li>
  <li><a href="#low-level-design" id="toc-low-level-design" class="nav-link" data-scroll-target="#low-level-design">3 Low-Level Design</a>
  <ul class="collapse">
  <li><a href="#class-diagram" id="toc-class-diagram" class="nav-link" data-scroll-target="#class-diagram">3.1 Class Diagram</a></li>
  </ul></li>
  <li><a href="#user-interface-design" id="toc-user-interface-design" class="nav-link" data-scroll-target="#user-interface-design">User Interface Design</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="design-document" class="level1">
<h1>Design Document</h1>
<section id="design-considerations" class="level2">
<h2 class="anchored" data-anchor-id="design-considerations">1 Design Considerations</h2>
<section id="assumptions" class="level3">
<h3 class="anchored" data-anchor-id="assumptions">1.1 Assumptions</h3>
<section id="section" class="level5">
<h5 class="anchored" data-anchor-id="section"></h5>
<ul>
<li>The user should be able to enter and remove job details, job offers, adjust comparison settings, and compare jobs</li>
<li>Data that has been entered into the system is persisted, and is loaded after the application is opened back up.</li>
<li>The user will have sufficient hardware capabilities to handle the application’s performance requirements.</li>
<li>Android Room provides a reliable method for the user to store data.</li>
<li>Standard security practices will adequately protect user data from unauthorized access.</li>
</ul>
</section>
</section>
<section id="constraints" class="level3">
<h3 class="anchored" data-anchor-id="constraints">1.2 Constraints</h3>
<section id="platform-compatibility" class="level4">
<h4 class="anchored" data-anchor-id="platform-compatibility">Platform Compatibility</h4>
<ul>
<li><p>The application targets Android 13, introducing behavior changes and new APIs that may affect user experience. To ensure broad compatibility, testing across devices running Android 12 through Android 13 is critical, as API availability varies by version.</p></li>
<li><p>The large Android ecosystem effects how different devices may or may not uniformly adopt Android 13. This could impact functionality or appearance. Figure [1] illustrates the current distribution of Android 13 users, highlighting the importance of compatibility considerations.</p></li>
</ul>
<p><img src="Images/AndroidSDK.png" class="img-fluid"></p>
</section>
<section id="platform-security" class="level4">
<h4 class="anchored" data-anchor-id="platform-security">Platform Security</h4>
<ul>
<li>Adhering to regulations for handling Personally Identifiable Information (PII) is crucial due to the sensitive nature of data like salary details. While Android Room adds a layer of abstraction over SQLite, we will employ SQLCipher for full database encryption and additional field-level encryption for heightened security. Despite these precautions, we recognize that no encryption method is impervious to attacks.</li>
</ul>
</section>
<section id="reliability-on-user-datamemory" class="level4">
<h4 class="anchored" data-anchor-id="reliability-on-user-datamemory">Reliability on User data/memory</h4>
<ul>
<li>The use of Android Room defines a SQLite database that resides on the users local device. Because the database is stored locally, an internet connection is not required. However, this relies on the user to have enough memory on their device to execute requests. Inadequate user memory will prevent the application’s ability to function correctly, relying on user awareness of their device’s storage capabilities to prevent execute all requests as intended.</li>
</ul>
</section>
<section id="user-accessibility" class="level4">
<h4 class="anchored" data-anchor-id="user-accessibility">User Accessibility</h4>
<ul>
<li>Designing an application to be intuitive and responsive, but also adhere to accessibility guidelines often oppose one another. The design must comply with regulatory rules to comply with accessibility guidelines. This may limit design aspects such as contrast, color, bright images, etc. While Android provides accessibility hints, lack of access to a robust team to conduct usability testing will present a challenge to our four person group.</li>
</ul>
</section>
</section>
<section id="system-environment" class="level3">
<h3 class="anchored" data-anchor-id="system-environment">1.3 System Environment</h3>
<section id="database-management" class="level4">
<h4 class="anchored" data-anchor-id="database-management">Database Management</h4>
<ul>
<li><p>Android Room will be used for database management.</p></li>
<li><p>The Room persistence library provides an abstraction layer over SQLite to allow fluent database access while harnessing the full power of SQLite. In particular, Room provides the following benefits:</p>
<ul>
<li>Compile-time verification of SQL queries.</li>
<li>Convenience annotations that minimize repetitive and error-prone boilerplate code.</li>
<li>Streamlined database migration paths</li>
</ul></li>
</ul>
</section>
<section id="android-13-api-33" class="level4">
<h4 class="anchored" data-anchor-id="android-13-api-33">Android 13 &amp; API 33</h4>
<ul>
<li>The application is designed for Android Operating System. Specifically, android 13 is the targeted system, and SDK 33 is the targeted SDK. Usability testing is conducted to ensure broad use and compatibility with the broader Android audience.</li>
</ul>
</section>
<section id="development-environment" class="level4">
<h4 class="anchored" data-anchor-id="development-environment">Development Environment</h4>
<ul>
<li><p>The Application is developed using Android Studios</p></li>
<li><p>Gradle 8.2 is used to compile, build, and package the application</p></li>
<li><p>Java 17 is the primary programming language. However, the application contains XML, and Structured Query Language (SQL).</p></li>
<li><p>A collaborative Git environment is used for version control, data integrity, and workflow management.</p></li>
</ul>
</section>
</section>
</section>
<section id="architectural-design" class="level2">
<h2 class="anchored" data-anchor-id="architectural-design">2 Architectural Design</h2>
<section id="database-architecture" class="level4">
<h4 class="anchored" data-anchor-id="database-architecture">Database Architecture</h4>
<p><img src="Images/DatabaseArc.png" class="img-fluid"></p>
<p>Figure 2 represents the broad architectural structure for the Database class. The database class defines the database configuration and serves as the application’s main access point to the persisted data. The class is annotated with a <code>@Database</code> annotation that includes an entities array that lists all of the data entities associated with the database. The class must be an abstract class that extends the Database class. For each Data Access Object (DAO) class that is associated with the database, the database class must define an abstract method that has zero arguments and returns an instance of the DAO class.</p>
<p>The database will be responsible to store and retrieve all information about the users current job, job offers, and comparison settings</p>
<p>To visualize this, it’s helpful to think of data entities as objects within the Database Room. Entities in Room represent the app’s data structures, which are mapped to tables within the SQLite database. Each entity, annotated with <span class="citation" data-cites="Entity">@Entity</span>, corresponds to a table where its fields represent columns. The <span class="citation" data-cites="primaryKey">@primaryKey</span> specifies that the ‘id’ field as the primary key, and it will be automatically generated. These can be referenced later for specific purposes. <span class="citation" data-cites="ColumnInfo">@ColumnInfo</span> is used to specify the name of the column in the database, ensuring our data model aligns with our database layout. For example, in our Job entity, fields like title, company, city, and state are mapped to respective columns, facilitating organized data storage and retrieval.</p>
<pre><code>@Entity
public class Job {
    @PrimaryKey
    public int uid;
&nbsp;&nbsp;&nbsp;&nbsp;
    @ColumnInfo(title = "title")
    public String title;

    @ColumnInfo(company = "company")
    public String company;

&nbsp;&nbsp;&nbsp;&nbsp;@ColumnInfo(city = "city")
    public String city;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;@ColumnInfo(state = "state")
    public String state;
}</code></pre>
<p>The DAO (Data Access Object) plays the role of abstracting the complexity of database access. Annotated with <span class="citation" data-cites="Dao">@Dao</span>, it defines a set of methods for performing database operations, allowing to perform queries and manipulations. Methods within a DAO interface are annotated to represent specific SQL queries or transactions. In the code below, we use <span class="citation" data-cites="Query">@Query</span> for fetching data, <span class="citation" data-cites="Insert">@Insert</span> for adding records, and <span class="citation" data-cites="Delete">@Delete</span> for removing them. Each method performs interactions with the database. For example, our JobDao includes methods for retrieving job entries, inserting multiple jobs, and deleting a specific job.</p>
<pre><code>@Dao
public interface JobDao {
    @Query("SELECT * FROM job")
    List&lt;Job&gt; getAll();

    @Query("SELECT * FROM job WHERE title = :title AND company = :company")
    Job findByTitleAndCompany(String title, String company);

    @Insert
    void insertAll(Job... jobs);

    @Delete
    void delete(Job job);
}</code></pre>
</section>
<section id="component-diagram" class="level3">
<h3 class="anchored" data-anchor-id="component-diagram">2.1 Component Diagram</h3>
<p><img src="Images/ComponentDiagram.png" class="img-fluid"></p>
<p>The component diagram depicted in figure 3 displays the structural relationships between the components in the application. Components are autonomous, encapsulated units within the application.</p>
<p>The Main Menu serves as the central hub from which users can navigate to various functionalities: Comparison Settings, Current Job Details, and Job Offers. Each of these functionalities is represented as a distinct component, reflecting their one-to-one relationship with the Main Menu. There is one condition which enable the user to access the comparison menu from the main menu. If the user already has entered a current job, and the user has entered at least one job offer, then they are able to navigate to the comparison menu.</p>
<p>Job Offers component allows navigation to the Comparison Menu under two specific conditions: If the user has entered at least two job offers, or the user has entered one job offer and has entered a current job, the user may navigate to the comparison menu.</p>
<p>The Comparison Menu acts as a gateway to the Compare Job Offers component, which is accessible when the user has selected at least two jobs for comparison. It also provides options for the user to navigate back to the Main Menu or to the Job Offers component.</p>
<p>In the Compare Job Offers component, users can view selected job offers as a side-by-side comparison. From here, users can initiate a new comparison by returning to the Comparison Menu or choose to go back to the Main Menu.</p>
</section>
<section id="deployment-diagram" class="level3">
<h3 class="anchored" data-anchor-id="deployment-diagram">2.2 Deployment Diagram</h3>
<p><img src="Images/DeploymentDiagram.png" class="img-fluid"></p>
<p>This application is developed as a school project and not intended for immediate real-world deployment. However, understanding the deployment process will be important for future deployment. The deployment diagram depicted below illustrates the application’s packaging and installation process on any compatible Android device.</p>
<p>The diagram showcases three primary components that are packaged into the Application Package (.apk) file:</p>
<ul>
<li><strong>Compiled Classes</strong>: These represent the compiled Java code that defines the application’s functionality.</li>
<li><strong>Compiled Resources</strong>: This includes all of the Android resources such as layouts, strings, and images.</li>
<li><strong>AndroidManifest.xml</strong>: The manifest file, which declares the application’s permissions, components, and minimum API/SDK requirements.</li>
</ul>
<p>These components are compiled and packaged into an .apk file, which is the standard format for Android applications. When the application is installed on an Android device, the .apk is unpacked, and the manifest file guides the operating system in setting up the application’s execution environment.</p>
<p>The execution environment on the device is responsible for running the application. It interacts with the Android Room Database, which is created and managed locally on the device. This allows the application to store and retrieve data persistently, enabling functionalities such as saving job details and comparison settings directly on the user’s device without requiring an external database connection.</p>
</section>
</section>
<section id="low-level-design" class="level2">
<h2 class="anchored" data-anchor-id="low-level-design">3 Low-Level Design</h2>
<section id="class-diagram" class="level3">
<h3 class="anchored" data-anchor-id="class-diagram">3.1 Class Diagram</h3>
<p>Ommitted</p>
</section>
</section>
<section id="user-interface-design" class="level2">
<h2 class="anchored" data-anchor-id="user-interface-design">User Interface Design</h2>
<p><img src="Images/UserInterfaceDesign.png" class="img-fluid"></p>
<p>The diagram in figure [ ] depicts the graphical user interface (GUI) design. From the main menu, the user can navigate to any of the five possible screens.</p>
<ul>
<li><p>The <code>Current Job</code> GUI loads current job details if one exists. It also allows the user to input job details to be saved to the database.</p></li>
<li><p>The Comparison Settings GUI loads comparison settings if they exist, or it allows the user to input comparison settings.</p></li>
<li><p>The Enter Job Offer GUI allows the user to enter job offers. Selecting <code>Compare with Current Job</code> allows the user to navigate directly to the Job Comparison screen if the user has previously entered a current job.</p></li>
<li><p>The Comparison Menu allows user to view, delete, and compare jobs based on selected jobs via a checklist. Selecting the <code>Compare</code> launches the Job Comparison GUI.</p></li>
<li><p>The Job Comparison GUI allows the user to view the selected jobs as a side by side comparison. Selecting <code>New Comparison</code> will return the user to the Comparison menu.</p></li>
<li><p>If the user enters at least one job offer, and the user has a current job stored, then the user may select <code>Compare Selected Jobs</code> from the main menu. This will launch the Job Comparison GUI.</p></li>
</ul>
<p>The figure above demonstrates the importance of the database as the main access point to persistent data. Every screen requires access the database to either store or retrieve data.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>